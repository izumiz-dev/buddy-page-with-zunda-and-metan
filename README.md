# ずんだもんと四国めたんの会話拡張機能

このリポジトリは、Webページの内容をずんだもんと四国めたんというキャラクターが会話形式で解説してくれるChrome拡張機能を実装したものです。AIを活用してページの内容を理解し、キャラクターの個性を活かした自然な会話形式で解説します。さらに、VOICEVOXを使用して実際の音声で読み上げる機能も備えています。

## 構成
* **フロントエンド**: TypeScript、Chrome Extension API
* **AI処理**: Google Gemini API (gemini-2.0-flashモデル)（Webページ内容の理解と会話生成）
* **音声合成**: VOICEVOX API（ずんだもん・四国めたんの音声生成）
* **ビルドツール**: TypeScript, pnpm, esbuild 

## 特徴的な実装
1. **キャラクター性の表現**
   * ずんだもん: 語尾に「〜のだ」「〜なのだ」をつける、東北地方をモチーフにした「ずんだもち」の妖精、元気で好奇心旺盛
   * 四国めたん: おっとりした話し方、丁寧語を使用、時々中二病的な言動、冷静で説明上手
2. **会話生成プロンプト**
   * マークダウン形式でキャラクター設定と会話の特徴を定義
   * ずんだもんが質問し、四国めたんが解説するパターンを基本構造に
   * JSON形式の会話データを生成（詳細なキャラクター指定が可能）
3. **UI実装**
   * ドラッグ可能な会話ウィンドウ
   * キャラクターごとに色分けされた会話バブル
   * 再生中のテキストがハイライト表示
4. **音声合成**
   * キャラクターごとの音声設定（VOICEVOX内の話者ID指定）
   * 音声データのプリロードによる滑らかな再生

## 必須環境

1. [Node.js](https://nodejs.org/) (v16以上)
2. [pnpm](https://pnpm.io/) (v7以上)
3. [VOICEVOX](https://voicevox.hiroshiba.jp/) (音声合成に使用)
4. [Google Gemini API キー](https://aistudio.google.com/app/apikey)

## 開発セットアップ

### 1. リポジトリのクローン

```bash
git clone https://github.com/yourusername/buddy-page-with-zunda-and-metan.git
cd buddy-page-with-zunda-and-metan
```

### 2. 依存関係のインストール

```bash
pnpm install
```

### 3. 開発モードでの実行

```bash
pnpm dev
```

### 4. ビルド

```bash
pnpm build
```

## 拡張機能のインストール方法

1. `pnpm build` を実行してビルド
2. Chromeで `chrome://extensions` を開く
3. 「デベロッパーモード」を有効化
4. 「パッケージ化されていない拡張機能を読み込む」をクリック
5. `dist` ディレクトリを選択

## 拡張機能の使い方

1. 拡張機能をインストール後、Chromeの拡張機能設定ページ（chrome://extensions を開いて「詳細」をクリック）から設定を行います
   - Gemini API キーを設定（Google AI Studioから取得）
   - VOICEVOX サーバーURLを設定（通常はデフォルトのままでOK）
   - 各キャラクターの音声IDを設定（必要に応じてカスタマイズ）
2. Webページを開き、拡張機能のアイコンをクリック
3. 「会話を開始」ボタンをクリック
4. ずんだもんと四国めたんがページ内容を会話形式で解説します
5. 「再生」ボタンをクリックすると音声で読み上げが始まります

## 技術的特徴
1. **JSON形式のデータ処理**
   * Gemini APIから会話をJSON形式で生成
   * キャラクターと発話テキストを構造化
   * 効率的な音声合成連携を実現
2. **モジュール設計**
   * 機能ごとに分離されたクラスとモジュール
   * 再利用可能なユーティリティ関数
3. **非同期処理**
   * Promise/async-awaitを活用した非同期処理
   * メッセージパッシング（バックグラウンド⇔コンテンツスクリプト間）
4. **エラーハンドリング**
   * 各APIとの通信エラーに対する適切な処理
   * フォールバックパーサーによる堅牢性確保
5. **UI/UX**
   * ドラッグ可能なウィンドウ
   * 会話再生時の視覚的フィードバック
   * キャラクターごとのデザイン差異

## ライセンス

MIT

## 謝辞

- [VOICEVOX](https://voicevox.hiroshiba.jp/)
- [Google Gemini API](https://ai.google.dev/)